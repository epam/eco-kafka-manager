<!--
 * Copyright 2020 EPAM Systems
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 -->
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="templates :: header(~{},~{::/html/head/script},~{})">
    <script type="text/javascript" th:src="@{/js/ui_lib_browser.js}"></script>
</head>
<body>

<script type="text/javascript" th:inline="javascript">

    /*<![CDATA[*/

    var currentOffsets = [[${currentOffsets}]];
    var realRangeBounds = [[${realRangeBounds}]];
    var fetchedValueFormat = [[${browseParams.getValueFormat() != null ? browseParams.getValueFormat().name() : null}]];
    var fullScreen = [[${browseParams.getFullScreen()}]];
    var showGrid = [[${showGrid}]]

    /*]]>*/

    $(function () {

        var sortingOrderTimestamp = [2, 'desc'];
        var sortingOrderPartition = [0, 'desc'];
        var sortingOrderOffset = [1, 'desc'];

        var columnClasses = showGrid ?
            [ { className: "vertical-line-class", targets: "_all" },
                { className: "vertical-line-class-selected", targets: [ 1, 3 ] } ] :
            [ { className: "vertical-line-class-selected", targets: [ 1, 3 ] } ];

        var dataTable = $('#recordTable').DataTable({
            paging: false,
            info: false,
            scrollX: true,
            scrollY: "40vh",
            scrollCollapse: true,
            fixedColumns: {
                left: 4
            },
            columnDefs: columnClasses,
            order: [
                sortingOrderTimestamp,
                sortingOrderPartition,
                sortingOrderOffset
            ],
            fixedHeader: true,
            language: {
                searchPlaceholder: "Enter this page search expression"
            }
        });

        $('#all-partition-checkbox').click(function (e) {
            $('.partition-checkbox').each(function (idx, elem) {
                var checked = $('#all-partition-checkbox').prop('checked');
                $(elem).prop('checked', checked);
                $(elem).trigger('change');
            });
        });

        $('.partition-checkbox').change(function () {
            var partition = $(this).data('partition');
            var enabled = $(this).is(':checked');
            $('#pe_' + partition).val(enabled ? '1' : '0');
            $('#p_min_' + partition).prop('disabled', !enabled);
            $('#p_max_' + partition).prop('disabled', !enabled);
        });


        $('.partition-checkbox').each(function (idx, elem) {
            if ($(elem).is(':checked')) {
                var partition = $(elem).data('partition');
                if(currentOffsets !== null) {
                    var currentOffset = currentOffsets[partition];
                    if (currentOffset !== undefined) {
                        $('#p_min_' + partition).val(currentOffset.smallest);
                        $('#p_min_p_inc_' + partition).html(getMinBoundsLabel(currentOffset));
                        $('#p_min_inc_' + partition).val(currentOffset.smallestInclusive);

                        $('#p_max_' + partition).val(currentOffset.largest);
                        $('#p_max_p_inc_' + partition).html(getMaxBoundsLabel(currentOffset));
                        $('#p_max_inc_' + partition).val(currentOffset.largestInclusive);
                    }
                }
                if(realRangeBounds !== null) {
                    var realBounds = realRangeBounds[partition];
                    if (realBounds !== undefined) {
                        $('#p_min_range_' + partition).val(realBounds.smallest);
                        $('p_min_range_label_' + partition).html(realBounds.smallest + getMinBoundsLabel(realBounds));
                        $('#p_min_p_inc_' + partition).html(getMinBoundsLabel(realBounds));
                        $('#p_min_inc_' + partition).val(realBounds.smallestInclusive);
                        $('#p_max_range_' + partition).val(realBounds.largest);
                    }
                }
            }
        })

        $('.previous-offsets-link').click(function (e) {
            submitFetchForm("FETCH_BACKWARD", "Fetching data backward...");
        });

        $('.next-offsets-link').click(function (e) {
            e.preventDefault();
            submitFetchForm("FETCH_FORWARD", "Fetching data forward...");
        });

        $("#fetchButton").click(function (e) {
            submitFetchForm("FETCH_RANGE", "Fetching data by range...");
        })

        $('#all-columns-link').click(function (e) {
            e.preventDefault();
            $('.column-checkbox').each(function (idx, elem) {
                $(elem).prop('checked', true);
                $(elem).trigger('change');
            });
        });

        $('#none-columns-link').click(function (e) {
            e.preventDefault();
            $('.column-checkbox').each(function (idx, elem) {
                $(elem).prop('checked', false);
                $(elem).trigger('change');
            });
        });

        $("#offsets-timestamp").datetimepicker({
            format:'dd/mm/yyyy hh:ii:ss',
            autoclose: true

        });

        $('#search-offsets-for-time-link').click(function (e) {
            e.preventDefault();
            var stringValue = $('#offsets-timestamp').val();
            var date = moment(stringValue, 'DD/MM/YYYY HH:mm:ss', true);
            if (date && date.isValid()) {
                document.getElementById('calculated-timestamp').value = date.parseZone(0).unix() * 1000;
                submitFetchForm("FETCH_UNTIL_TIME", "Fetching records by timestamp...");
            }
            if(!date.isValid()) {
                showInfo("error","Error while fetching data", "Wrong date format! (" + stringValue + ")");
            }
        });

        $('#search-offsets-for-time-link-fwd').click(function (e) {
            e.preventDefault();
            var stringValue = $('#offsets-timestamp').val();
            var date = moment(stringValue, 'DD/MM/YYYY HH:mm:ss', true);
            if (date && date.isValid()) {
                document.getElementById('calculated-timestamp').value = date.parseZone(0).unix() * 1000;
                submitFetchForm("FETCH_FROM_TIME", "Fetching records by timestamp...");
            }
            if(!date.isValid()) {
                showInfo("error","Error while fetching data", "Wrong date format! (" + stringValue + ")");
            }
        });

        $('#keyFormat').change(function (e) {
            $('#keyFormatLabel').html('Key format: <div class="text-danger d-inline"><b>' + e.currentTarget.value + '</b></div>');
        });

        $('#valueFormat').change(function (e) {
            $('#valueFormatLabel').html('Value format: <div class="text-danger d-inline"><b>' + e.currentTarget.value + '</b></div>');
            showHideColumnSelectorDependingOnFormatSelected(fetchedValueFormat);
        });

        var submitFetchForm = (fetchMode, waitingText) => {
            if(!validateRanges()) {
                return;
            }
            if(checkIfAtLeastOnePartitionSelected()) {
                removeColumnSelectorIfFormatNotEqualToFecthedOne(fetchedValueFormat);
                storeOrApplySelectedColumns();
                $('#fetch-mode').val(fetchMode);
                showWaitingSign(waitingText);
                $('#fetch-form').submit();
            } else {
                showInfo("error","Error while fetching data", "At least one partition have to be checked!");
            }
        }

        $('[data-bs-toggle="popover"]').popover({html: true,});

        var checkIfAtLeastOnePartitionSelected = () => {
            var result = false;
            $('.partition-checkbox').each((idx, elem) => {
                if(elem.checked) {
                    result = true;
                }
            });
            return result;
        }

        var toggleFullScreen = ( mode ) => {
            if(mode==='maximize') {
                $('#recordTableContainer').addClass("full-screen");
                $('.dataTables_scrollBody').css("min-height","80vh");
                $('#full-screen-button').text("Exit full screen");
                $('#previous-offsets-link-in-grid').css("display",  "block");
                $('#next-offsets-link-in-grid').css("display", "block");
                $('#full-screen').val(true);
            } else {
                $('#recordTableContainer').removeClass("full-screen");
                $('.dataTables_scrollBody').css("min-height","45vh");
                $('#full-screen-button').text("Full screen");
                $('#previous-offsets-link-in-grid').css("display",  "none");
                $('#next-offsets-link-in-grid').css("display", "none");
                $('#full-screen').val(false);
            }
        }

        $('#full-screen-button').click(function (e) {
            if($('#recordTableContainer')[0].classList.contains("full-screen")) {
                toggleFullScreen('minimize');
            } else {
                toggleFullScreen('maximize');
            }
        });

        $(document).on('click', function (e) {
            hidePopoverIfClickedOutside(e);
        });

        $('#to-min-button').click( function(event) {
            event.preventDefault();
            setBeginOffsetsToMin(event);
        });
        $('#to-max-button').click( function(event) {
            event.preventDefault();
            setEndOffsetsToMax(event);
        });

        if(fullScreen) {
            toggleFullScreen('maximize');
        }

        hideWaitingSign();
        setTimeout(dataTable.columns.adjust().draw(), 1000);

        table.on( 'preDraw', function () { showWaitingSign("Rendering table..."); })
            .on( 'draw', function () {
                $('.table').css({"width":"100%"});
                hideWaitingSign();
            });

    });

    function getMinBoundsLabel(offsetRange) {
        return offsetRange.smallestInclusive ? '[' : '(';
    }
    function getMaxBoundsLabel(offsetRange) {
        return offsetRange.largestInclusive ? ']' : ')';
    }

    function copySchemaContent(id) {
        var text = $('#schema_content_'+id).attr("data-bs-content");
        var button = document.getElementById('copy_button_'+id);
        copyText(text,button);
    }

    function validateRanges() {
        var result = true;
        $('.partition-checkbox').each(function (idx, elem) {
            if ($(elem).is(':checked')) {
                var partition = $(elem).data('partition');
                var smallest = parseInt($('#p_min_' + partition).val());
                var largest = parseInt($('#p_max_' + partition).val());
                if(largest<smallest) {
                    showInfo('error', 'Error while checking range offsets',
                        'Partition='+partition+': largest='+largest+' less then smallest='+smallest+'.');
                    result = false;
                }
            }
        });
        return result;
    }



</script>

<div th:replace="templates :: navbar"></div>

<div th:replace="templates :: loading-modal"></div>

<div th:replace="templates :: info-modal"></div>

<div class="main-content">

    <div class="container-fluid">

        <div class="row">

            <div class="col-md-12">

                <div>
                    <a class="text-primary" th:href="@{/topics/{name}(name=${browseParams.topicName})}">
                        <i class="fa fa-chevron-left text-primary"></i> Back To Topic
                    </a>
                    <div class="topic-title mt-1 mb-1" th:utext="'<b>BROWSE DATA:</b> ' + ${browseParams.topicName}" ></div>
                </div>

                <div class="card mb-3">

                    <form
                            id="fetch-form"
                            th:action="@{/topics/{name}/browser(name=${browseParams.topicName})}"
                            method="post">

                        <input id="fetch-mode" name="fetch-mode" type="hidden" value="FETCH_RANGE" />
                        <input id="full-screen" name="full-screen" th:value="${browseParams.getFullScreen()}" type="hidden" value="false" />
                        <input id="calculated-timestamp" name="calculated-timestamp" type="hidden" value="0"/>
                        <div class="card-header card-flex">
                            <div class="col">
                                <a data-bs-toggle="collapse" href="#fetch-params"
                                   role="button"
                                   class="text-secondary collapse-button-chevron"
                                   id="topic_browser.fetch-params-button">
                                    <i class="fa fa-chevron-down"></i>
                                </a>
                                <b class="m-1">Fetch parameters:</b>
                            </div>
                            <div class="col" th:utext="${'Partitions: <div class=''text-primary d-inline''><b>' + browseParams.listPartitions().size() + '</b></div>'}"> </div>
                            <div class="col"><div th:utext="${'From offset: <b><div class=''text-primary d-inline''>' + (offsetFetchedRangesSummary == null ? '-' : offsetFetchedRangesSummary.smallest) + '</div>/' + offsetRangesSummary.smallest + '</b>'}"></div></div>
                            <div class="col"><div th:utext="${'To offset: <b><div class=''text-primary d-inline''>' + (offsetFetchedRangesSummary == null ? '-' : offsetFetchedRangesSummary.largest) + '</div>/' + offsetRangesSummary.largest + '</b>'}"></div></div>
                            <div class="col"
                                 th:utext="${'Key format: <div class=''text-primary d-inline''><b>' + browseParams.getKeyFormat() + '</b></div>'}"
                                 id="keyFormatLabel">
                            </div>
                            <div class="col" th:utext="${'Value format: <div class=''text-primary d-inline''><b>' + browseParams.getValueFormat() + '</b></div>'}"
                                 id="valueFormatLabel">
                            </div>
                            <div class="col">Custom parameters: <div class='text-primary d-inline'><b>no</b></div></div>
                        </div>
                        <div class="card-body" id="fetch-params">

                            <div class="row mb-3">
                                <div class="form-group col col-md-4">
                                    <label for="keyFormat">Key Format</label>
                                    <select class="form-select" name="keyFormat" id="keyFormat">
                                        <option
                                                th:each="format : ${T(com.epam.eco.kafkamanager.TopicRecordFetchParams$DataFormat).values()}"
                                                th:value="${format}"
                                                th:text="${format}"
                                                th:selected="${browseParams.getKeyFormat() == format}">
                                        </option>
                                    </select>
                                    <label for="valueFormat">Value Format</label>
                                    <select class="form-select mb-3" name="valueFormat" id="valueFormat">
                                        <option
                                                th:each="format : ${T(com.epam.eco.kafkamanager.TopicRecordFetchParams$DataFormat).values()}"
                                                th:value="${format}"
                                                th:text="${format}"
                                                th:selected="${browseParams.getValueFormat() == format}">
                                        </option>
                                    </select>



                                    <div class="card mb-3"
                                         id="column-selector-panel"
                                         th:if="${fetchedRecords != null AND !fetchedRecords.isEmpty()}">

                                        <div class="card-header collapsed-header card-flex">
                                            <div>Columns</div>
                                            <a data-bs-toggle="collapse" href="#column-selector"
                                               role="button"
                                               class="to-right text-secondary collapse-button"
                                               id="topic_browser.columns-collapse-button">
                                                <i class="fa fa-caret-down"></i>
                                            </a>
                                        </div>
                                        <div id="column-selector" class="collapse">
                                            <div class="card-body">
                                                <div class="mb-2">
                                                    <a id="all-columns-link"
                                                       href="#"
                                                       class="btn btn-primary btn-sm small">
                                                        All <i class="fa fa-check-circle-o"></i>
                                                    </a>
                                                    <a id="none-columns-link"
                                                       href="#"
                                                       class="btn btn-primary btn-sm small">
                                                        None <i class="fa fa-times-circle-o"></i>
                                                    </a>
                                                </div>
                                                <div class="row"
                                                     th:with="groupSize=${fetchedRecords.determineColumnsGroupSize(4,30)}">
                                                    <th:block
                                                            th:each="groupIndex : ${#numbers.sequence(0, 3)}">
                                                        <div class="col col-md-6">
                                                            <th:block
                                                                    th:each="columnGroup : ${fetchedRecords.getColumnsGroup(groupIndex,groupSize)}">
                                                                <div
                                                                        class="checkbox"
                                                                        style="margin: 0px auto;"
                                                                        th:each="column : ${columnGroup}">
                                                                    <label
                                                                            th:class="${!column.present ? 'text-muted' : ''}"
                                                                            style="word-wrap:break-word;">
                                                                        <input
                                                                                class="column-checkbox"
                                                                                type="checkbox"
                                                                                th:name="${'ce_' + column.name}"
                                                                                th:attr="data-column=${column.name}"
                                                                                th:checked="${browseParams.isColumnEnabled(column.name)}"/>
                                                                        <span th:text="${column.name}"></span>
                                                                    </label>
                                                                </div>
                                                            </th:block>
                                                        </div>
                                                    </th:block>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>



                                <div class="col-md-8">
                                    <div id="offsets-parameters">
                                        <div class="container-fluid">
                                            <div class="row">

                                                <div style="margin-left: auto;" class="input-group col-md-3">
                                                    <input id="offsets-timestamp"
                                                           type="text"
                                                           name="offsetsTimestamp"
                                                           autocomplete="off"
                                                           placeholder="Enter timestamp"
                                                           th:value="${browseParams.offsetsTimestamp}"
                                                           class="form-control input-timestamp col-auto"
                                                           title="Search offsets for time"/>
                                                    <button id="search-offsets-for-time-link"
                                                            href="#"
                                                            class="btn btn-primary col-auto btn-sm btn-time-search"
                                                            title="Search offsets for time backward">
                                                        <i class="fa fa-chevron-left" aria-hidden="true"></i>
                                                    </button>
                                                    <button id="search-offsets-for-time-link-fwd"
                                                            href="#"
                                                            class="btn btn-primary col-auto btn-sm btn-time-search"
                                                            title="Search offsets for time forward">
                                                        <i class="fa fa-chevron-right" aria-hidden="true"></i>
                                                    </button>

                                                </div>

                                            </div>

                                            <div class="mb-3">
                                                <div><b>Offsets parameters</b></div>
                                                <div class="row">

                                                    <div class="form-group mb-1">
                                                        <div class="input-group">
                                                            <span class="input-group-text col-md-2"
                                                                  th:text="'Partition'"></span>
                                                            <div class="input-group-text col-auto">
                                                                <input type="checkbox"
                                                                       id="all-partition-checkbox"
                                                                       class="form-check-input mt-0"
                                                                       th:attr="data-partition=${partition}"
                                                                       th:checked="true"/>
                                                            </div>
                                                            <span class="input-group-text col-md-2">
                                                                MIN
                                                            </span>
                                                            <span class="input-group-text form-control">
                                                                <div>FIRST BATCH</div>
                                                                <button id="to-min-button"
                                                                        class="btn btn-success btn-sm btn-small to-right">
                                                                    to MIN
                                                                </button>
                                                            </span>
                                                            <span class="input-group-text form-control">
                                                                <div>LAST BATCH</div>
                                                                <button id="to-max-button"
                                                                        class="btn btn-success btn-sm btn-small to-right">
                                                                    to MAX
                                                                </button>
                                                            </span>
                                                            <span class="input-group-text col-md-2">
                                                                MAX
                                                            </span>
                                                        </div>
                                                    </div>

                                                    <th:block
                                                            th:each="partition : ${browseParams.listPartitions()}"
                                                            th:with="enabled=${browseParams.isPartitionEnabled(partition)},
                                                                     offset=${browseParams.getPartitionOffset(partition)},
                                                                     range=${offsetRanges.get(partition)}">
                                                        <div class="form-group mb-1">
                                                            <div class="input-group">
                                                               <span class="input-group-text col-md-2"
                                                                     th:text="${partition}"></span>
                                                                <div class="input-group-text col-auto">
                                                                    <input type="checkbox"
                                                                           class="partition-checkbox form-check-input mt-0"
                                                                           th:attr="data-partition=${partition}"
                                                                           th:checked="${enabled}"/>
                                                                </div>
                                                                <input type="hidden"
                                                                       th:id="${'p_min_range_' + partition}"
                                                                       th:name="${'p_min_range_' + partition}"
                                                                       th:value="${range.smallest}"/>
                                                                <span class="input-group-text col-md-2"
                                                                      th:id="${'p_min_range_label_' + partition}"
                                                                      th:text="${(range.smallestInclusive ? '[' : '(') + range.smallest}"></span>
                                                                <span class="input-group-text col-auto"
                                                                      th:id="${'p_min_inc_p_' + partition}"
                                                                      th:name="${'p_min_inc_p_' + partition}"
                                                                      th:text="${(offset.smallestInclusive ? '[' : '(')}"></span>
                                                                <input type="hidden"
                                                                       th:id="${'p_min_inc_' + partition}"
                                                                       th:name="${'p_min_inc_' + partition}"
                                                                       th:value="${offset.smallestInclusive}">
                                                                <input type="number"
                                                                       class="form-control"
                                                                       th:min="${range.smallest}"
                                                                       th:max="${range.largest}"
                                                                       th:disabled="${!enabled}"
                                                                       th:id="${'p_min_' + partition}"
                                                                       th:name="${'p_min_' + partition}"
                                                                       th:value="${offset.smallest}"/>
                                                                <input type="number"
                                                                       class="form-control"
                                                                       th:min="${range.smallest}"
                                                                       th:max="${range.largest}"
                                                                       th:disabled="${!enabled}"
                                                                       th:id="${'p_max_' + partition}"
                                                                       th:name="${'p_max_' + partition}"
                                                                       th:value="${offset.largest}"/>
                                                                <span class="input-group-text col-auto"
                                                                      th:id="${'p_max_inc_p_' + partition}"
                                                                      th:name="${'p_max_inc_p_' + partition}"
                                                                      th:text="${(offset.largestInclusive ? ']' : ')')}"></span>
                                                                <input type="hidden"
                                                                       th:id="${'p_max_inc_' + partition}"
                                                                       th:name="${'p_max_inc_' + partition}"
                                                                       th:value="${offset.largestInclusive}">
                                                                <span class="input-group-text col-md-2"
                                                                      th:id="${'p_max_range_label_' + partition}"
                                                                      th:text="${range.largest + (range.largestInclusive ? ']' : ')')}"></span>
                                                                <input type="hidden"
                                                                       th:id="${'p_max_range_' + partition}"
                                                                       th:name="${'p_max_range_' + partition}"
                                                                       th:value="${range.largest}"/>
                                                                <input type="hidden"
                                                                       th:id="${'pe_' + partition}"
                                                                       th:name="${'pe_' + partition}"
                                                                       th:value="${enabled ? '1' : '0'}"/>
                                                            </div>
                                                        </div>
                                                    </th:block>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class="card-footer card-flex">
                            <div class="col-auto">
                                <a
                                        th:if="${hasPreviousOffsets != null AND hasPreviousOffsets}"
                                        id="previous-offsets-link"
                                        href="#"
                                        class="btn btn-success btn-sm previous-offsets-link">
                                    <i class="fa fa-chevron-left"></i>
                                </a>
                                <a id="fetchButton" class="btn btn-success btn-sm" role="button">
                                    Fetch
                                </a>
                                <a
                                        th:if="${hasNextOffsets != null AND hasNextOffsets}"
                                        id="next-offsets-link"
                                        href="#"
                                        class="btn btn-success btn-sm next-offsets-link">
                                    <i class="fa fa-chevron-right"></i>
                                </a>
                            </div>


                            <label class="centred to-right col-auto" for="timeout">Polling record timeout (MS)</label>
                            <input
                                    type="number"
                                    class="form-control col-auto"
                                    min="-1"
                                    max="300000"
                                    id="timeout"
                                    name="timeout"
                                    th:value="${browseParams.timeout}"/>


                            <label class="centred col-auto" for="limit">Limit</label>
                            <input type="number"
                                   class="form-control col-auto"
                                   min="10"
                                   max="100"
                                   id="limit"
                                   name="limit"
                                   th:value="${browseParams.limit}"/>

                        </div>
                    </form>
                </div>

                <div id="recordTableContainer" class="card" th:if="${fetchedRecords != null}">
                    <div class="card-header card-flex">

                        <a
                                th:if="${hasPreviousOffsets != null AND hasPreviousOffsets}"
                                id="previous-offsets-link-in-grid"
                                href="#"
                                style="display: none"
                                class="btn btn-success btn-sm previous-offsets-link">
                            <i class="fa fa-chevron-left"></i>
                        </a>
                        <a
                                th:if="${hasNextOffsets != null AND hasNextOffsets}"
                                id="next-offsets-link-in-grid"
                                href="#"
                                style="display: none"
                                class="btn btn-success btn-sm next-offsets-link">
                            <i class="fa fa-chevron-right"></i>
                        </a>
                        <h7><span th:text="${fetchSummary}"></span></h7>
                        <button id="full-screen-button" class="btn btn-secondary btn-sm to-right">Full screen</button>
                    </div>
                    <div class="pre-scrollable"
                         style="padding-top: 0;">

                        <table id="recordTable"
                               aria-sort="descending"
                               th:if="${!fetchedRecords.isEmpty()}"
                               class="table cell-border">
                            <thead>
                            <tr>
                                <th>Partition</th>
                                <th>Offset</th>
                                <th>Timestamp (UTC)</th>
                                <th>Key</th>
                                <th>Headers</th>
                                <th th:if="${browseParams.isAvroOrProtobufValueFormat()}">Attributes
                                </th>
                                <th th:if="${browseParams.isAvroOrProtobufValueFormat() and schemaCatalogUrlTemplate.show()}">Schema
                                </th>
                                <th th:each="column : ${fetchedRecords.listSelectedColumns()}">
                                        <span th:text="${column.name}"
                                              th:class="${!column.present ? 'text-muted' : ''}">
                                        </span>
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="record : ${fetchedRecords}"
                                th:with="recordId=${record.partition + '_' + record.offset} ">
                                <td th:text="${record.partition}"></td>
                                <td th:text="${record.offset}"></td>
                                <td th:text="${record.timestampFormatted}"></td>
                                <td
                                        th:if="${record.nullKey}"
                                        class="danger"
                                        title="Record Key is NULL">
                                </td>
                                <td
                                        th:if="${!record.nullKey}"
                                        th:text="${record.key}"
                                        style="word-wrap: break-word;min-width:50px;max-width:300px;">
                                </td>
                                <td style="text-align: center;vertical-align: middle;">
                                    <a style="vertical-align: middle"
                                       th:if="${record.hasHeaders()}"
                                       href="javascript:void(0)"
                                       th:attr="data-bs-container='body',data-bs-toggle='popover',data-bs-content=${record.headersPrettyJson},title='Headers',data-bs-html=true"
                                       data-bs-toggle="popover"
                                       data-html="true">
                                        <i class="fa fa-eye info"></i>
                                    </a>
                                </td>

                                <td th:if="${browseParams.isAvroOrProtobufValueFormat()}"
                                    style="text-align: center;vertical-align: middle;">
                                    <a style="vertical-align: middle"
                                       th:if="${record.hasAttributes()}"
                                       href="javascript:void(0);"
                                       data-bs-toggle="popover"
                                       data-bs-backdrop=""
                                       th:attr="data-bs-container='body',
                                                    data-bs-content=${record.attributesPrettyJson},
                                                    title='Attributes',
                                                    data-bs-html=true">
                                        <i class="fa fa-list info"></i>
                                    </a>
                                </td>

                                <td th:if="${record.hasAttributes() and schemaCatalogUrlTemplate.show()}">
                                    <div style="justify-content:start;display:flex;flex-direction:row; gap: 10px;align-items: center;">
                                        <a th:href="@{|${schemaCatalogUrlTemplate.resolve(record.RegistrySchema.schemaName)}|}"
                                           target="_blank">
                                            <i th:class="${'fa '+schemaCatalogUrlTemplate.getIcon()+' info'}"></i>
                                        </a>
                                        <a  th:id="${'schema_content_'+recordId}"
                                            th:if="${record.hasAttributes()}"
                                            href="javascript:void(0);"
                                            data-bs-toggle="popover"
                                            th:attr="data-bs-container='body',
                                                         data-bs-toggle='popover',
                                                         data-bs-content=${record.RegistrySchema.schemaAsString},
                                                         title=${record.RegistrySchema.schemaType.name() + ' schema'},
                                                         data-bs-html=true">
                                            <i class="fa fa-list info"></i>
                                        </a>
                                        <button th:attr="onclick=${'copySchemaContent('''+recordId+''')'}"
                                                th:id="${'copy_button_'+recordId}"
                                                class="btn btn-sm btn-success copy-button">Copy</button>
                                    </div>
                                </td>

                                <td th:if="${record.nullValue and browseParams.isAvroOrProtobufValueFormat()}" class="bg-danger"><span></span></td>

                                <td
                                        th:each="column : ${fetchedRecords.listSelectedColumns()}"
                                        th:title="${record.typeSimpleName(column)}"
                                        th:class="${record.nullValue ? 'bg-danger' : ''}" >

                                    <span th:if="${record.nullValue}"></span>
                                    <span th:if="${!record.nullValue}"
                                          th:utext="${record.getShort(column)}"
                                          th:title="${record.get(column)}"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                    </div>
                </div>

            </div>

        </div>

    </div>

</div>

<div th:replace="templates :: footer"></div>

</body>
</html>
